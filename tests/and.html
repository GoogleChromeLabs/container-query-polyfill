<!DOCTYPE html>
<style>
  @container name (min-width: 0px) {
    main {
      --match: true;
    }
  }

  #a {
    outline: 1px solid red;
    height: 150px;
    resize: both;
    overflow: auto;
    container-type: size;
  }

  h1 {
    font-size: 10px;
  }

  @container ((min-width: 200px) and (min-height: 200px)) {
    h1 {
      font-size: 30px;
    }
  }

  @container ((max-width: 200px) and (max-height: 200px)) {
    h1 {
      font-size: 20px;
    }
  }
</style>
<div id="a">
  <div id="b">
    <h1>H1</h1>
  </div>
</div>
<script type="module">
  import './../dist/shadow-container-query-polyfill.modern.js';
  import {doubleRaf, testSuite, assert} from './test-utils.js';

  testSuite('Manual transpiling', async () => {
    const a = document.querySelector('#a');
    const configs = [
      {width: 150, height: 150, expectedPropValues: {fontSize: '20px'}},
      {width: 150, height: 250, expectedPropValues: {fontSize: '10px'}},
      {width: 250, height: 250, expectedPropValues: {fontSize: '30px'}},
      {width: 250, height: 150, expectedPropValues: {fontSize: '10px'}},
    ];
    for (const {width, height, expectedPropValues} of configs) {
      const style = `width: ${width}px; height: ${height}px;`;
      a.style = style;
      await doubleRaf();
      const computed = getComputedStyle(document.querySelector('h1'));
      for (const [prop, expectedValue] of Object.entries(expectedPropValues)) {
        assert(
          computed[prop] === expectedValue,
          `Expected ${prop} to be ${expectedValue}, got ${computed[prop]} (case: width=${width}, height=${height})`
        );
      }
    }
  });
</script>
